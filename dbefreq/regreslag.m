function [b,rsq,pred] = regreslag(xx,yy,lag)% Function [b,rsq,pred] = REGRES1(XX,YY,Lag)%   Returns the simple linear regression of YY on XX% %      XX = regression predictor          YY = predictand%       b = [b1 b2] in y = b1 + b2*x     rsq = coef.det.%    pred = b1 + b2*x                   pred = predictions% %   XX,YY must be single-column vectors of same length. %   Data pairs with XX or YY missing (=NaN) are ignored. %   XX leads YY if Lag > 0 (Lag is optional). if length(xx) ~= length(yy); disp('Lengths don''t match'); return; endif ~exist('lag'); lag = 0; endpred = nan*ones(length(yy),1);if lag >= 0	j1x = 1; j1y = 1 + lag;	j2x = length(xx) - lag;	j2y = length(xx);else	j1y = 1; j1x = 1 + lag;	j2y = length(xx) - lag;	j2x = length(xx);endxx = xx(j1x:j2x); yy = yy(j1y:j2y); i = find(yy~=nan & xx~=nan);len = length(i); x = ones(len,2);x = xx(i); y = yy(i);r = corrcoef([x y]); rsq = r(1,2)^2;b2 = r(1,2)*std(y)/std(x);b1 = mean(y) - b2*mean(x);b = [b1 b2];xx(i) = x;pred(j1y:j2y) = b1 + b2*xx;