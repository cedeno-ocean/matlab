function rhov = mcorr(X,Y)%Function rhov = mcorr(X,Y) -- Matrix correlation by columns%  This function calculates the correlation coefficient cloumnwise between %  two same-size matrices X & Y, returning a vector <rhov> of correlations %  for the columns. The columns of both X & Y may contain NaN's (NaNs will%  be replaced by zeros).%%  If X is a column vector, the correlations of X with all columns of Y %  are computed. %%  Timing: 1.85 seconds for X,Y(500,1000) on PowerMac G4/450%  D.B. Enfield, NOAA/AOML, June 2000% Test the sizes of X & Yif size(X,2) == 1 & size(Y,2) > 1	X = X*ones(1,size(Y,2)); elseif size(X,2) ~= size(Y,2), 	disp(['X & Y are not the same size or X is not vector'])end	X = X - ones(length(X(:,1)),1)*meanmiss(X);  % remove means of XY = Y - ones(length(Y(:,1)),1)*meanmiss(Y);  % remove means of YX = nan2miss(X,0);Y = nan2miss(Y,0); % replace NaNs with zerosxycov = sum(X.*Y);                   % compute the X-Y covariancesx = sqrt(sum(X.*X));                % std.dev. of Xsy = sqrt(sum(Y.*Y));                % std.dev. of Yrhov = xycov./(sx.*sy);              % compute the correlationsreturn